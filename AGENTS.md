# Plurality Wiki 贡献与开发约定（AGENTS.md）

本文件定义了本项目的贡献规则与开发约定，供人类贡献者与自动化工具（如 Codex）使用。  
所有贡献应严格遵循以下要求，以保持条目结构与站点的一致性。

---

## 1. 通用约定

- **语言**：所有条目、说明文档与提交信息统一使用简体中文。
- **词条目录**：
  - 所有词条（Markdown 文档）必须存放在仓库根目录下的 `entries/` 子目录。
  - 严禁在其他目录编写词条文件。
  - `entries/` 下可根据主题建立二级目录（如 `entries/诊断与临床/`、`entries/系统体验与机制/`）。
- **命名规范**：
  - 文件名采用 首字母大写的英文短横线格式
  - 一级标题统一采用 `中文名（English/缩写）` 格式。
  - 若为诊断或疾病，在括号内使用标准缩写（如 `重度抑郁障碍（MDD）`）。
- **目录索引同步**：
  - 新增或修改词条时，必须同步维护：
    - `index.md` → 全局目录索引
    - `Glossary.md` → 术语表
- **文档结构**：
  - Markdown 一级标题：词条名称
  - 二级及以下标题：按内容层级递增
  - 若存在触发警示（⚠），必须置于文首
  - 延伸阅读或者相关条目规范使用完整目录（如 `entries/系统角色与类型/Admin.md`、`entries/系统体验与机制/Autopilot.md`）

---

## 2. 站点配置与前端规则

- 所有站点文件放在 **仓库根目录**，必须包含：
  - `index.html`
  - `_sidebar.md`
  - `_coverpage.md`
  - `.nojekyll`（不可删除，避免 GitHub Pages 过滤下划线文件）
- 所有静态资源引用必须使用相对路径（如 `./assets/xxx.png`），禁止使用以 `/` 开头的绝对路径，确保在 GitHub Pages 子路径下正常渲染。

---

## 3. PDF 导出脚本（`tools/pdf_export/`）

- **运行环境**：Python ≥ 3.10
- **代码规范**：
  - 使用 `pathlib.Path` 处理路径，禁止字符串拼接路径。
  - 保持函数拆分、`dataclass` 结构与类型标注。
  - 解析/生成 LaTeX、Markdown 时需考虑跨平台兼容性，并对用户输入做必要转义。
- **文档同步**：
  - 修改导出逻辑时，必须同步更新 `tools/pdf_export/README_pdf_output.md`。

---

## 4. 提交与版本管理

- **提交信息（Commit Message）建议前缀**：
  - `feat:` 新增条目或功能
  - `fix:` 修复错误或错别字
  - `docs:` 文档说明调整
  - `refactor:` 代码重构或结构调整
  - `chore:` 构建/配置/依赖更新
- **Pull Request 说明**：
  - 必须包含：改动动机、主要变更、潜在风险、相关条目或链接。
- **忽略文件**：
  - 提交前请检查 `ignore.md`，确保需要排除的文件已正确维护。

---

## 5. 测试与检查

- 修改 Python 代码后，至少运行：

  ```bash
  python -m compileall tools/pdf_export/export_to_pdf.py
  ```

确认无语法错误。

- 如引入额外依赖或命令行选项，必须在 `README.md` 或相关文档中注明。
- Markdown 新增/修改条目后，运行本地预览：

  ```bash
  npx docsify serve .
  ```

  确认页面能正常渲染。

---

## 6. 路线图（供 Codex 使用）

* [ ] 校验所有词条均位于 `entries/` 目录
* [ ] 校验 `index.md` 与 `README_wiki.md` 是否同步更新
* [ ] 自动检查 `.nojekyll` 是否存在
* [ ] PDF 导出脚本异常捕获与测试增强
* [ ] 集成 CI：提交时自动检查路径、Python 语法、Docsify 渲染

## 自动化维护规则（Codex / 其他代理）

> 本节约束使用 Codex/GPT 等自动化工具对本仓库进行条目维护与批量改动的最低要求。**所有自动化改动必须遵循《CONTRIBUTING.md》**。

### 基本原则

- **遵循规范**：严格按照仓库根目录的 `CONTRIBUTING.md` 执行写作规范、条目模板、提交流程与自检清单。
- **最小可审查单位**：拆分为小 PR；每个 PR 聚焦单一主题（例如：修正链接 / 统一标题层级 / 更新参考文献）。
- **可追溯性**：所有自动化生成/重写内容必须在 PR 描述中说明来源、方法与范围（例如：正则批量替换、规则引擎、脚本名与摘要）。
- **不造证据**：不得虚构来源；引用需指向可核验的权威文献（ICD-11、DSM-5-TR、WHO/APA 指南、系统综述等）。
- **不破坏链接**：若改动涉及文件重命名/路径调整，必须同步更新 `index.md`、站点导航与交叉引用。
- **可回滚**：对大规模格式化/统一风格的提交，需在 PR 中附上回滚脚本或最小复原指引。

### 提交信息（Conventional Commits）

- `feat:` 新增条目/新增章节
- `fix:` 错误修复（链接/引用/格式）
- `docs:` 文档与索引更新（不影响语义）
- `refactor:` 结构与命名重构（不改变内容含义）
- `chore:` 任务脚本、CI、批处理等维护项
- `style:` 空格/缩进/行尾等非语义变更

### 自动化自检清单（每个 PR 必填）

- [ ] 本次变更是否对齐 `CONTRIBUTING.md` 的写作规范与条目模板？
- [ ] 是否更新了受影响的 `index.md`/导航链接？
- [ ] 是否保持了图片/表格的无障碍与版权要求？
- [ ] 变化点是否以要点列表在 PR 描述中清晰列出？
- [ ] 是否在本地/CI 通过 Markdown lint 与链接有效性检查？

### 质量与合规（建议接入 CI）

- Markdown 语法与风格：`markdownlint` / `remark-lint`
- 链接有效性：`lychee` / `remark-validate-links`
- 文件命名规范与标题校验：自定义脚本或 `remark` 插件
- 术语一致性：对照 `glossary.md` 的术语表进行关键术语扫描

> 若自动化工具无法满足上述要求，请改为人工审校或拆分任务。
