<!doctype html>
<html lang="zh-Hans">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>内容管理系统 - Multiple Personality System Wiki</title>
    <meta name="description" content="Multiple Personality System Wiki 词条管理后台" />

    <!-- Sveltia CMS 配置 -->
    <link href="config.yml" type="text/yaml" rel="cms-config-url">

    <style>
      /* 基础样式 - 使用系统字体，零外部依赖 */
      * {
        box-sizing: border-box;
      }

      html, body {
        margin: 0;
        padding: 0;
        /* 全平台系统字体栈（iOS/Android/Windows/macOS/Linux）*/
        font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Hiragino Sans GB",
                     "Noto Sans CJK SC", "Noto Sans SC", "Roboto",
                     "Microsoft YaHei", "微软雅黑", "Segoe UI",
                     "Source Han Sans SC", "WenQuanYi Micro Hei",
                     sans-serif;
        min-height: 100vh;
      }

      /* 代码和等宽字体 */
      code, pre, tt, kbd, samp {
        font-family: "SF Mono", Monaco, Menlo,
                     "Roboto Mono", "Droid Sans Mono",
                     "Cascadia Code", "Cascadia Mono", Consolas,
                     "Courier New", monospace;
      }
    </style>
  </head>
  <body>
    <!-- 初始加载提示 -->
    <div id="loading-message" style="
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f5f5f5;
      z-index: 9999;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    ">
      <div style="text-align: center; max-width: 500px; padding: 20px;">
        <h2 style="color: #009688; margin-bottom: 16px;">正在加载 Sveltia CMS...</h2>
        <p style="color: #666; line-height: 1.6;">
          首次使用请准备 GitHub Personal Access Token<br>
          <small style="color: #999;">需要 <code>repo</code> 权限</small>
        </p>
        <div style="margin-top: 20px;">
          <div style="
            width: 40px;
            height: 40px;
            margin: 0 auto;
            border: 3px solid #009688;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
          "></div>
        </div>
      </div>
    </div>
    <style>
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
    </style>

    <!-- Sveltia CMS - 使用国内镜像加速 -->
    <script type="module">
      // 尝试多个 CDN 源，确保至少一个可用
      const cdnSources = [
        'https://unpkg.com/@sveltia/cms/dist/sveltia-cms.js',           // 官方源
        'https://cdn.jsdelivr.net/npm/@sveltia/cms/dist/sveltia-cms.js' // jsDelivr 国内可用
      ];

      async function loadSveltiaCMS() {
        for (const src of cdnSources) {
          try {
            await import(src);
            console.log(`Sveltia CMS 加载成功: ${src}`);
            // 隐藏加载提示
            const loading = document.getElementById('loading-message');
            if (loading) loading.style.display = 'none';
            return;
          } catch (error) {
            console.warn(`无法从 ${src} 加载，尝试下一个源...`);
          }
        }
        // 所有源都失败
        document.body.innerHTML = `
          <div style="padding: 40px; text-align: center; font-family: sans-serif;">
            <h1 style="color: #e53e3e;">⚠️ CMS 加载失败</h1>
            <p>无法从任何 CDN 源加载 Sveltia CMS。</p>
            <p>请检查网络连接或稍后重试。</p>
            <details style="margin: 20px auto; max-width: 600px; text-align: left; background: #f5f5f5; padding: 15px; border-radius: 8px;">
              <summary style="cursor: pointer; font-weight: bold; color: #009688;">如何手动获取 Token?</summary>
              <ol style="margin-top: 10px; line-height: 1.8;">
                <li>访问 <a href="https://github.com/settings/tokens/new" target="_blank" rel="noopener">GitHub Token 创建页面</a></li>
                <li>勾选 <code>repo</code> 权限</li>
                <li>生成 Token 并复制</li>
                <li>刷新本页面并粘贴 Token</li>
              </ol>
            </details>
            <p style="margin-top: 20px;">
              <a href="https://github.com/mps-team-cn/Multiple_personality_system_wiki"
                 style="color: #3182ce; text-decoration: none;">
                返回 GitHub 仓库 →
              </a>
            </p>
          </div>
        `;
      }

      loadSveltiaCMS();
    </script>

    <!-- 自定义样式 -->
    <link rel="stylesheet" href="admin.css" />
  </body>
</html>
